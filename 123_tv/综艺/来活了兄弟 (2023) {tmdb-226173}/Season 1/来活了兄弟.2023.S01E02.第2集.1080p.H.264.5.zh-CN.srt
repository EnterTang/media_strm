1
00:00:00,140 --> 00:00:03,330
很快我们会带来一期关于直播的科普

2
00:00:03,330 --> 00:00:06,100
教大家从零架设直播平台

3
00:00:06,100 --> 00:00:07,030
但是在那之前

4
00:00:07,030 --> 00:00:11,170
咱们应该先了解一些关于视频基础知识

5
00:00:11,170 --> 00:00:13,460
你觉得一段1080P 60帧的视频

6
00:00:13,460 --> 00:00:16,270
一秒钟应该占多少空间？

7
00:00:16,270 --> 00:00:19,370
1M？2M？我们不妨来算一下

8
00:00:19,370 --> 00:00:25,720
一幅1920x1080的画面有200万像素

9
00:00:25,720 --> 00:00:27,370
每个像素3字节

10
00:00:27,370 --> 00:00:31,470
这就意味着一帧就要占用5.7MB的空间

11
00:00:31,470 --> 00:00:32,540
那么理论上说

12
00:00:32,540 --> 00:00:37,100
60fps的视频一秒钟就要占用300多MB的空间

13
00:00:37,100 --> 00:00:39,360
是我计算有问题吗？

14
00:00:39,360 --> 00:00:42,490
一秒钟的视频怎么可能300MB呢？你看

15
00:00:42,490 --> 00:00:45,130
这就是视频压缩的魅力所在了

16
00:00:45,130 --> 00:00:48,010
我们平时看的视频都是经过压缩的

17
00:00:48,010 --> 00:00:51,530
所以一秒只有1-2M

18
00:00:51,530 --> 00:00:55,100
那么从300MB压缩到1MB

19
00:00:55,100 --> 00:00:57,990
这么神奇的操作是怎么做到的呢？

20
00:00:57,990 --> 00:01:01,420
关于「视频」又有哪些我们应该知道的故事呢？

21
00:01:01,420 --> 00:01:05,610
我们今天就来和你详细聊聊视频编码的那些事

22
00:01:05,980 --> 00:01:09,190
首先 让我来列举一些关于视频的属性

23
00:01:09,190 --> 00:01:11,990
看看你们知不知道是什么意思

24
00:01:11,990 --> 00:01:14,290
考试时间开始了

25
00:01:14,290 --> 00:01:15,300
这个是什么

26
00:01:15,300 --> 00:01:16,160
分辨率吧

27
00:01:16,160 --> 00:01:19,980
这个我相信看我们视频的人应该都明白什么意思吧

28
00:01:19,980 --> 00:01:21,270
横向有多少像素

29
00:01:21,270 --> 00:01:23,020
乘以纵向有多少像素

30
00:01:23,020 --> 00:01:24,440
得到的就是你的分辨率

31
00:01:24,440 --> 00:01:26,510
分辨率越高画面越清晰

32
00:01:26,510 --> 00:01:27,780
这个好像很简单啊

33
00:01:27,780 --> 00:01:29,860
那么这个呢：1080p

34
00:01:30,510 --> 00:01:33,540
这个就是1920x1080的意思吧

35
00:01:33,540 --> 00:01:35,620
是不是一种缩写？

36
00:01:35,620 --> 00:01:36,800
如果你这么想的话

37
00:01:36,800 --> 00:01:37,860
那我就要问你了

38
00:01:37,860 --> 00:01:41,320
你知道1080i是什么意思吗？

39
00:01:41,320 --> 00:01:49,180
其实这个1080p和1080i的p和i分别指的是逐行扫描和隔行扫描

40
00:01:49,180 --> 00:01:50,700
在显像管时代

41
00:01:50,700 --> 00:01:53,730
视频和我们今天是不太一样的

42
00:01:53,730 --> 00:01:56,580
CRT电视的画面是通过电子枪

43
00:01:56,580 --> 00:01:58,630
字幕君已阵亡

44
00:01:58,630 --> 00:02:00,190
一行行扫过去的

45
00:02:00,190 --> 00:02:02,090
这就是逐行扫描

46
00:02:02,090 --> 00:02:04,240
这一开始没什么问题

47
00:02:04,240 --> 00:02:04,970
直到有一天

48
00:02:04,970 --> 00:02:07,640
电视台决定增加画面的清晰度

49
00:02:07,640 --> 00:02:09,490
让观众看得更舒服

50
00:02:09,490 --> 00:02:11,450
但这样问题就来了

51
00:02:11,450 --> 00:02:13,060
你增加清晰度的同时

52
00:02:13,060 --> 00:02:16,830
观众的「水管」还是这么小

53
00:02:16,830 --> 00:02:18,480
无线电的带宽不够用

54
00:02:18,480 --> 00:02:22,360
于是电视台就想了个馊主意

55
00:02:22,360 --> 00:02:28,090
我们把从屏幕上方扫到下方所获得的画面称为一个「场」

56
00:02:28,090 --> 00:02:29,520
逐行扫一轮

57
00:02:29,520 --> 00:02:32,050
得到的场就是一帧完整的画面

58
00:02:32,050 --> 00:02:34,100
那电视台是怎么做的呢

59
00:02:34,100 --> 00:02:38,330
它们把一帧画面分割成两个场来扫描

60
00:02:38,330 --> 00:02:41,640
每个场都是隔一行扫描一次的

61
00:02:41,640 --> 00:02:43,080
先扫描奇数场

62
00:02:43,080 --> 00:02:44,760
再扫描偶数场

63
00:02:44,760 --> 00:02:46,990
把两个场的画面拼起来

64
00:02:46,990 --> 00:02:49,310
就得到了一帧完整的图像

65
00:02:49,310 --> 00:02:51,760
这就是隔行扫描

66
00:02:51,760 --> 00:02:53,800
隔行扫描相比逐行扫描

67
00:02:53,800 --> 00:02:56,010
带宽降低了一半

68
00:02:56,010 --> 00:02:57,880
大大减少了电视台的开销

69
00:02:57,880 --> 00:03:02,430
或者也可以在相同的带宽下获得更高的清晰度了

70
00:03:02,430 --> 00:03:04,750
其实在8102年

71
00:03:04,750 --> 00:03:06,820
我们都在网上看视频了

72
00:03:06,820 --> 00:03:09,860
很少看隔行的电视节目了

73
00:03:09,860 --> 00:03:11,490
并不存在这个问题了

74
00:03:11,490 --> 00:03:15,040
你可能再也不需要用到隔行扫描了

75
00:03:15,040 --> 00:03:17,550
那我为什么还要提这个呢

76
00:03:17,550 --> 00:03:19,550
你不就是想装逼嘛

77
00:03:19,780 --> 00:03:21,550
哎……装逼是一个原因

78
00:03:21,550 --> 00:03:22,620
最重要的原因什么

79
00:03:22,620 --> 00:03:24,250
就是你们有些人啊

80
00:03:24,250 --> 00:03:28,560
在视频编码的时候会选错场序

81
00:03:28,560 --> 00:03:31,340
结果渲染出来的视频就是这个样子的

82
00:03:31,340 --> 00:03:34,060
如果你们知道了逐行和隔行的含义

83
00:03:34,060 --> 00:03:37,210
渲染视频的时候就不会乱选了嘛……

84
00:03:37,210 --> 00:03:39,720
接下来看第二个属性

85
00:03:39,720 --> 00:03:42,280
这个很眼熟对吧

86
00:03:42,280 --> 00:03:43,330
帧率这个

87
00:03:43,330 --> 00:03:44,280
大家都是玩游戏的

88
00:03:44,280 --> 00:03:45,460
应该都懂

89
00:03:45,460 --> 00:03:48,480
关于帧率我们之前也做过一期科普视频

90
00:03:48,480 --> 00:03:49,850
你可以先去了解一下

91
00:03:49,850 --> 00:03:51,620
这里我只讲一个问题

92
00:03:51,620 --> 00:03:53,480
相信也是大家比较好奇的问题

93
00:03:53,480 --> 00:04:01,190
为什么会有29.97和59.94这种奇怪的帧数

94
00:04:01,190 --> 00:04:03,340
剩下那0.03帧去哪了呢？

95
00:04:03,340 --> 00:04:06,020
这就要问美国人了

96
00:04:06,020 --> 00:04:07,210
很久以前在美国

97
00:04:07,210 --> 00:04:11,170
黑白电视都是525线分辨率、30帧的

98
00:04:11,170 --> 00:04:13,920
因为美国的电力频率是60Hz

99
00:04:13,920 --> 00:04:14,570
为了方便嘛

100
00:04:14,570 --> 00:04:17,770
电视取个一半30fps也很正常

101
00:04:17,770 --> 00:04:18,860
到了50年代

102
00:04:18,860 --> 00:04:21,450
美国开始打造NTSC制式

103
00:04:21,450 --> 00:04:24,280
用于从黑白电视转到彩色电视

104
00:04:24,280 --> 00:04:25,980
但是他们遇到了一个问题

105
00:04:25,980 --> 00:04:26,760
在那个时候

106
00:04:26,760 --> 00:04:29,490
电视信号是通过无线电波传输的

107
00:04:29,490 --> 00:04:31,300
在无线电波频谱中

108
00:04:31,300 --> 00:04:36,040
每个电视频道都能分到4.5MHz的频段

109
00:04:36,040 --> 00:04:37,540
在黑白电视时期

110
00:04:37,540 --> 00:04:39,100
这个非常完美

111
00:04:39,100 --> 00:04:42,810
正正好好可以塞下视频和音频信号

112
00:04:42,810 --> 00:04:45,630
但是彩色电视一来就麻烦了

113
00:04:45,630 --> 00:04:48,420
这个频段挤得太满了

114
00:04:48,420 --> 00:04:50,340
硬要把彩色信号塞进去

115
00:04:50,340 --> 00:04:52,380
就会被音频信号干扰

116
00:04:52,380 --> 00:04:54,740
最后的显示效果就很差

117
00:04:54,740 --> 00:04:56,670
为了将两种信号「错位」开

118
00:04:56,670 --> 00:05:03,310
就要保证整个信号频段的频率4.5MHz可以整除线速率

119
00:05:03,310 --> 00:05:05,070
听起来好复杂

120
00:05:05,070 --> 00:05:08,690
线速率就是每秒扫描多少根线

121
00:05:08,690 --> 00:05:09,900
但是科学家发现

122
00:05:09,900 --> 00:05:12,640
这样除下来并不是整数

123
00:05:12,640 --> 00:05:13,810
那怎么办呢

124
00:05:13,810 --> 00:05:16,800
它们可以选择增大电视节目的分辨率

125
00:05:16,800 --> 00:05:18,220
多加几根线

126
00:05:18,220 --> 00:05:19,490
这样也可以整除

127
00:05:19,490 --> 00:05:22,760
但这么做就不能兼容老的黑白电视了

128
00:05:22,760 --> 00:05:24,260
于是很无奈

129
00:05:24,260 --> 00:05:27,680
它们只能选择略微降低一点帧率

130
00:05:27,680 --> 00:05:29,800
近似29.97帧

131
00:05:29,800 --> 00:05:31,260
这么小的改变

132
00:05:31,260 --> 00:05:32,280
观众也察觉不到

133
00:05:32,280 --> 00:05:33,310
又能向下兼容

134
00:05:33,310 --> 00:05:35,080
实在是太聪明了

135
00:05:35,080 --> 00:05:36,000
然而大家也知道

136
00:05:36,000 --> 00:05:37,880
广电级标准一旦定下来了

137
00:05:37,880 --> 00:05:39,360
就很难再改变了

138
00:05:39,360 --> 00:05:40,610
因为我们的摄像设备

139
00:05:40,610 --> 00:05:44,840
我们的工作流程全都是基于这些标准生产和制定的

140
00:05:44,840 --> 00:05:47,620
这就是为什么直到2018年

141
00:05:47,620 --> 00:05:50,040
即便早就解决当年的问题了

142
00:05:50,040 --> 00:05:52,670
即便我们都在网上看视频了

143
00:05:52,670 --> 00:05:55,590
但我们还是在用29.97帧

144
00:05:55,590 --> 00:05:58,050
因为今天的摄像机和后期软件

145
00:05:58,050 --> 00:06:01,410
仍然是基于NTSC标准打造的。

146
00:06:01,410 --> 00:06:05,610
不过对于中国和欧洲的电视节目来说就没有这个问题

147
00:06:05,610 --> 00:06:08,320
因为我们的电力频率和美国不一样

148
00:06:08,320 --> 00:06:10,520
我们是50Hz的

149
00:06:10,520 --> 00:06:12,250
用的是欧洲的PAL制

150
00:06:12,250 --> 00:06:15,020
PAL制是N制推出10年以后打造的新标准

151
00:06:15,020 --> 00:06:17,900
专门改进了N制的这些奇怪的毛病

152
00:06:17,900 --> 00:06:19,920
并且不向下兼容

153
00:06:19,920 --> 00:06:21,990
你现在知道PS4为什么不向下兼容了吧

154
00:06:21,990 --> 00:06:22,990
为了稳(pian)定(qian)

155
00:06:22,990 --> 00:06:26,520
所以我国模拟信号的电视节目是25帧的

156
00:06:26,860 --> 00:06:28,250
那么问题来了

157
00:06:28,250 --> 00:06:29,850
我们渲染视频

158
00:06:29,850 --> 00:06:32,030
应该渲染多少帧的呢？

159
00:06:32,030 --> 00:06:34,740
我觉得这取决于原素材的帧数

160
00:06:34,740 --> 00:06:36,610
如果你录的是30帧

161
00:06:36,610 --> 00:06:38,560
那你就做30帧的视频

162
00:06:38,560 --> 00:06:41,340
如果你录的是29.97帧

163
00:06:41,340 --> 00:06:43,870
那就选择29.97帧

164
00:06:43,870 --> 00:06:46,500
跟着原素材走总没错的

165
00:06:46,500 --> 00:06:49,100
这个你们觉得是什么？

166
00:06:49,100 --> 00:06:51,390
视频格式吗？对的

167
00:06:51,390 --> 00:06:52,950
确实是视频格式

168
00:06:52,950 --> 00:06:55,140
但是这样说只答对了一半

169
00:06:55,140 --> 00:06:58,740
视频的格式是有封装格式和编码格式之分的

170
00:06:58,740 --> 00:07:01,940
而MP4就属于一种封装格式

171
00:07:01,940 --> 00:07:03,480
一种容器

172
00:07:03,480 --> 00:07:05,390
它规定了视频的外在

173
00:07:05,390 --> 00:07:08,910
他要和掌管内在的编码格式（比如Ｈ.264）配合起来

174
00:07:08,910 --> 00:07:10,540
才会有我们的视频

175
00:07:10,540 --> 00:07:11,540
换句话说

176
00:07:11,540 --> 00:07:13,980
MP4就是一层皮

177
00:07:13,980 --> 00:07:16,850
它和视频的质量没有必然关系

178
00:07:16,850 --> 00:07:23,340
常见的视频封装格式有MP4、FLV、AVI、MOV、3GP等等

179
00:07:23,340 --> 00:07:27,130
既然我刚刚说了封装只是一层皮

180
00:07:27,130 --> 00:07:30,670
那么格式的互相转换自然也是非常容易的

181
00:07:30,670 --> 00:07:33,580
你们很多人喜欢用格式工厂来转格式

182
00:07:33,580 --> 00:07:35,430
其实根本没必要

183
00:07:35,430 --> 00:07:37,540
比如你下了个B站的视频

184
00:07:37,540 --> 00:07:39,170
是FLV格式的

185
00:07:39,170 --> 00:07:40,180
Pr可能读不了

186
00:07:40,180 --> 00:07:41,380
你想转成MP4

187
00:07:41,380 --> 00:07:45,460
那么你就直接把它扔进MediaCoder

188
00:07:45,460 --> 00:07:47,390
容器选MP4

189
00:07:47,390 --> 00:07:50,540
然后音视频流全部选复制

190
00:07:50,540 --> 00:07:52,840
就是延续原来的音视频流

191
00:07:52,840 --> 00:07:54,040
然后开始转码

192
00:07:54,040 --> 00:07:54,630
你看

193
00:07:54,630 --> 00:07:56,480
一瞬间就完成了

194
00:07:56,480 --> 00:07:58,040
因为只是换层皮而已

195
00:07:58,040 --> 00:07:59,870
根本不需要重新编码的

196
00:07:59,870 --> 00:08:01,980
什么情况下需要重新编码呢

197
00:08:01,980 --> 00:08:06,800
当你新转换的封装格式不支持你原来的封装格式

198
00:08:06,800 --> 00:08:09,340
最典型的一个例子就是Youtube的视频

199
00:08:09,340 --> 00:08:11,750
原生使用的是VP9的编码

200
00:08:11,750 --> 00:08:13,630
而不是H.264

201
00:08:13,630 --> 00:08:16,560
这种情况下如果要转MP4的格式

202
00:08:16,560 --> 00:08:18,000
就需要重新编码了

203
00:08:18,000 --> 00:08:20,900
因为MP4是不认识VP9的

204
00:08:20,900 --> 00:08:23,320
大多数情况下就不用担心这个问题

205
00:08:23,320 --> 00:08:24,810
所以下次转格式的时候

206
00:08:24,810 --> 00:08:27,610
可别再犯傻重新渲染一遍了哈

207
00:08:27,610 --> 00:08:29,230
接下来这个参数

208
00:08:29,230 --> 00:08:31,500
就极其关键了

209
00:08:31,500 --> 00:08:33,900
这个是码率

210
00:08:33,900 --> 00:08:36,790
我们一直说一个视频多少M码率的

211
00:08:36,790 --> 00:08:38,670
码率到底什么意思

212
00:08:38,670 --> 00:08:40,480
它的英文叫bitrate

213
00:08:40,480 --> 00:08:42,960
直译过来应该叫做「数据速率」

214
00:08:42,960 --> 00:08:47,980
就是视频每一秒所包含的数据量、信息量

215
00:08:47,980 --> 00:08:50,550
码率直接决定了视频的大小

216
00:08:50,550 --> 00:08:53,100
并且很大程度上也会影响视频的质量

217
00:08:53,100 --> 00:08:54,520
毕竟信息量大了

218
00:08:54,520 --> 00:08:58,140
你就有办法展现更多画面细节了对吧

219
00:08:58,140 --> 00:09:00,280
无论是直播还是上传视频

220
00:09:00,280 --> 00:09:02,920
对于码率都是非常敏感的

221
00:09:02,920 --> 00:09:04,510
一方面B站比较穷

222
00:09:04,510 --> 00:09:06,740
码率太高的视频太占空间了

223
00:09:06,740 --> 00:09:09,990
B站没那么多硬盘来存这些视频

224
00:09:09,990 --> 00:09:12,500
另一方面 观众的网也没那么快

225
00:09:12,500 --> 00:09:14,580
还要考虑流量的问题

226
00:09:14,580 --> 00:09:16,480
你一个视频就要花掉5G流量

227
00:09:16,480 --> 00:09:19,290
那我这一个月也看不了几个视频了对吧

228
00:09:19,290 --> 00:09:22,390
所以直播网站往往会有码率限制

229
00:09:22,390 --> 00:09:25,520
而视频网站往往也会有一根二压线

230
00:09:25,520 --> 00:09:26,350
比如在B站

231
00:09:26,350 --> 00:09:30,930
码率超过6Mbps（峰值24M）的视频都会被二次压缩

232
00:09:30,930 --> 00:09:31,730
作为UP主

233
00:09:31,730 --> 00:09:34,800
你要做的就是在这6Mbps的局限范围内

234
00:09:34,800 --> 00:09:37,340
压制出尽可能高质量的视频

235
00:09:37,340 --> 00:09:38,470
而作为主播

236
00:09:38,470 --> 00:09:40,560
你要做的也是在有限的码率内

237
00:09:40,560 --> 00:09:42,610
尽可能地提高直播画质

238
00:09:42,610 --> 00:09:45,320
同时 还得照顾到你的电脑性能

239
00:09:45,320 --> 00:09:46,670
要做到这些事

240
00:09:46,670 --> 00:09:49,260
你就需要了解下面这个东西了

241
00:09:49,260 --> 00:09:54,340
H.264是一种编码格式

242
00:09:54,340 --> 00:09:55,740
这个就比较复杂了

243
00:09:55,740 --> 00:09:58,840
我们得从视频压缩的原理说起

244
00:09:58,840 --> 00:10:01,510
我一开始就说了1080 60P的视频

245
00:10:01,510 --> 00:10:02,440
如果不压缩

246
00:10:02,440 --> 00:10:05,230
1秒就会占用300多MB的空间

247
00:10:05,230 --> 00:10:06,880
这根本不现实啊！

248
00:10:06,880 --> 00:10:10,260
所以你所看到的任何视频都是经过压缩的

249
00:10:10,260 --> 00:10:12,340
而视频通过什么方式去压缩

250
00:10:12,340 --> 00:10:14,010
压缩到什么程度

251
00:10:14,010 --> 00:10:17,390
靠的就是H.264这样的编码标准

252
00:10:17,390 --> 00:10:20,300
对于H.264等现代编码格式来说

253
00:10:20,300 --> 00:10:25,960
视频压缩是由「帧内压缩」和「帧间压缩」两种方式相结合的

254
00:10:25,960 --> 00:10:27,240
帧内压缩

255
00:10:27,240 --> 00:10:32,600
就是把视频里的每一帧画面都压缩成JPEG这类有损图像

256
00:10:32,600 --> 00:10:34,800
JPEG你们应该都认识吧

257
00:10:34,800 --> 00:10:38,720
最流行、也是最讨巧的图片压缩方法

258
00:10:38,720 --> 00:10:42,300
他就是利用了我们人眼对亮度非常敏感

259
00:10:42,300 --> 00:10:44,910
但对颜色比较麻木的这种特性

260
00:10:44,910 --> 00:10:48,340
将图片里的亮度信息尽可能保留下来

261
00:10:48,340 --> 00:10:51,220
然后对颜色信息进行大幅压缩

262
00:10:51,220 --> 00:10:53,700
尤其是画面中颜色比较复杂的细节部分

263
00:10:53,700 --> 00:10:54,900
反正你也注意不到

264
00:10:54,900 --> 00:10:56,460
扔掉也问题不大

265
00:10:56,460 --> 00:10:58,810
JPEG的图片压缩效率非常高

266
00:10:58,810 --> 00:11:05,180
以至于我们光是把无损视频里的每一帧用JPEG压缩一下

267
00:11:05,180 --> 00:11:08,770
就已经缩小了90%的视频体积了

268
00:11:08,770 --> 00:11:11,950
但这还是远远不够

269
00:11:11,950 --> 00:11:14,540
你看个视频每秒60帧画面里面

270
00:11:14,540 --> 00:11:19,410
其实只有几帧是原生的jpeg图像

271
00:11:19,410 --> 00:11:22,900
剩下的都是通过算法脑补出来的

272
00:11:22,900 --> 00:11:26,510
意思就是说我们只要记录那几帧关键画面

273
00:11:26,510 --> 00:11:31,710
再加上画面变化的一些小细节 物体的运动轨迹就可以了

274
00:11:31,710 --> 00:11:34,900
根本不需要完整记录中间这些画面

275
00:11:34,900 --> 00:11:37,800
这样就大大节省了视频的占用空间

276
00:11:37,800 --> 00:11:41,120
这就是帧间压缩最基本的理念

277
00:11:41,120 --> 00:11:42,720
反映到H.264里

278
00:11:42,720 --> 00:11:45,860
就有了I帧、P帧和B帧的概念

279
00:11:45,860 --> 00:11:48,760
其中I帧是完整的关键帧

280
00:11:48,760 --> 00:11:53,880
我们先把一个I帧分割成好多个8×8或16x16的“宏块”

281
00:11:53,880 --> 00:11:59,340
然后对I帧和它下一帧每个对应的宏块进行比较

282
00:11:59,340 --> 00:12:02,900
如果发现这前后两帧的宏块是有关联性的

283
00:12:02,900 --> 00:12:04,190
有规律可循的

284
00:12:04,190 --> 00:12:07,120
比如可能有两个宏块是完全一样的

285
00:12:07,120 --> 00:12:09,700
或者只是细微变了下位置

286
00:12:09,700 --> 00:12:10,460
那我们就知道了

287
00:12:10,460 --> 00:12:13,640
下一帧是可以预测出来的

288
00:12:13,640 --> 00:12:17,250
我们就把这下一帧称为P帧（预测帧）

289
00:12:17,250 --> 00:12:19,410
对于P帧里没有变化的宏块

290
00:12:19,410 --> 00:12:21,420
我们编码的时候直接写上

291
00:12:21,420 --> 00:12:23,640
照抄I帧 就行了

292
00:12:23,640 --> 00:12:25,010
而对于有变化的宏块

293
00:12:25,010 --> 00:12:27,860
我们比较出前后两帧的变化

294
00:12:27,860 --> 00:12:30,080
记录下变化的信息

295
00:12:30,080 --> 00:12:33,610
比如说这个宏块里的像素到底是变颜色了？

296
00:12:33,610 --> 00:12:36,150
还是运动了？还是怎样了

297
00:12:36,150 --> 00:12:38,760
我们编码的时候把这些变化记录下来

298
00:12:38,760 --> 00:12:40,700
解码的时候再预测回去

299
00:12:40,700 --> 00:12:42,440
这就是P帧

300
00:12:42,440 --> 00:12:44,590
它是在I帧的基础上预测出来的

301
00:12:44,590 --> 00:12:47,980
它相比I帧可以节约一半以上的空间

302
00:12:47,980 --> 00:12:50,630
那么B帧是什么呢？

303
00:12:50,630 --> 00:12:52,770
B帧是双向预测帧

304
00:12:52,770 --> 00:12:56,840
它是在I帧和P帧的基础上再进行预测

305
00:12:56,840 --> 00:12:59,940
而且B帧不仅参考前面的帧

306
00:12:59,940 --> 00:13:02,190
它还参考后面的帧

307
00:13:02,190 --> 00:13:05,600
它相比P帧又节省了一半以上的空间

308
00:13:05,600 --> 00:13:10,640
我们的视频就是由这些I帧、P帧和B帧组合出来的

309
00:13:10,640 --> 00:13:11,420
这就是为什么

310
00:13:11,420 --> 00:13:15,210
明明一部视频理论上1秒钟要占用300MB的空间

311
00:13:15,210 --> 00:13:18,730
但实际上10分钟都不一定有300MB

312
00:13:18,730 --> 00:13:21,380
这就是视频编码的魅力

313
00:13:21,380 --> 00:13:24,290
不过这样的压缩方式也带来了一个问题

314
00:13:24,290 --> 00:13:27,720
你看我现在的脸是很清晰的对吧

315
00:13:27,720 --> 00:13:31,680
那么我现在在视频里加入一些乱飞的火花

316
00:13:32,280 --> 00:13:36,290
再加入一些不知道什么五颜六色的东西

317
00:13:36,540 --> 00:13:40,560
现在整个屏幕都开始飘起了这些乱七八糟的东西

318
00:13:40,850 --> 00:13:42,470
然后你再看我的脸

319
00:13:42,470 --> 00:13:44,810
整个都糊了吧

320
00:13:44,810 --> 00:13:47,000
这是因为画面太复杂了

321
00:13:47,000 --> 00:13:48,880
信息量太大了

322
00:13:48,880 --> 00:13:51,860
首先这点码率根本塞不下

323
00:13:51,860 --> 00:13:57,100
其次电脑也根本没法预测你这个像素下一帧会走到哪里

324
00:13:57,100 --> 00:14:00,230
所以P帧和B帧画面都会严重失真

325
00:14:00,230 --> 00:14:02,780
遇到这种画面非常复杂的视频

326
00:14:02,780 --> 00:14:05,110
我们就需要用更高的画质预设

327
00:14:05,110 --> 00:14:07,370
以及可变码率来进行编码

328
00:14:07,370 --> 00:14:09,440
以获得更精确的算法

329
00:14:09,440 --> 00:14:11,640
如果你是Up主或者主播

330
00:14:11,640 --> 00:14:11,650
关于H.264编码 就有几个比较重要的概念
如果你是Up主或者主播

331
00:14:11,650 --> 00:14:14,500
关于H.264编码 就有几个比较重要的概念

332
00:14:14,520 --> 00:14:16,400
是你必须要了解的了

333
00:14:16,400 --> 00:14:17,940
一个是GOP

334
00:14:17,940 --> 00:14:23,130
GOP(Group Of Picture)指的就是每一组IPB帧的序列包含了多少帧

335
00:14:23,130 --> 00:14:28,860
或者换句话说就是一个I帧之后要经过多少帧才会出现下一个I帧

336
00:14:28,860 --> 00:14:30,140
GOP值越大

337
00:14:30,140 --> 00:14:34,600
就意味着视频里模拟出来的P、B帧越多

338
00:14:34,600 --> 00:14:37,270
同码率下的视频质量往往也就越高

339
00:14:37,270 --> 00:14:38,410
因为压缩率高了

340
00:14:38,410 --> 00:14:41,910
你就有更多闲置的码率去提高画面质量了

341
00:14:41,910 --> 00:14:47,000
另一个你要知道的是三种控制码率的方法

342
00:14:47,000 --> 00:14:50,100
CBR、VBR以及CRF

343
00:14:50,100 --> 00:14:52,360
先来说说CBR固定码率

344
00:14:52,360 --> 00:14:55,180
视频全程码率基本保持恒定

345
00:14:55,180 --> 00:14:58,480
每秒的数据量、文件大小都是可以预期的

346
00:14:58,480 --> 00:15:01,120
直播最常用到这种方式

347
00:15:01,120 --> 00:15:03,060
但CBR的局限性就在于

348
00:15:03,060 --> 00:15:05,960
不能根据场景来动态调整码率

349
00:15:05,960 --> 00:15:08,020
简单场景码率太浪费了

350
00:15:08,020 --> 00:15:10,000
复杂场景码率又不够用

351
00:15:10,000 --> 00:15:12,910
属于空间利用率最低的一种方法

352
00:15:12,910 --> 00:15:16,030
而VBR的意思是可变码率

353
00:15:16,030 --> 00:15:18,260
VBR需要设置一个目标码率

354
00:15:18,260 --> 00:15:22,120
编码过程中会为简单场景分配较少的码率

355
00:15:22,120 --> 00:15:25,110
为复杂的场景分配较多的码率

356
00:15:25,110 --> 00:15:26,060
按需分配

357
00:15:26,060 --> 00:15:26,370
怎么样

358
00:15:26,370 --> 00:15:28,500
是不是比CBR智能？

359
00:15:28,500 --> 00:15:29,200
除此之外

360
00:15:29,200 --> 00:15:32,300
如果你想要对码率做出更精确的限制

361
00:15:32,300 --> 00:15:34,440
VBR 还可以选择2-Pass

362
00:15:34,440 --> 00:15:35,880
渲染两遍

363
00:15:35,880 --> 00:15:38,230
第一遍先分析视频的复杂度

364
00:15:38,230 --> 00:15:41,770
一帧帧精确分配好视频各部分的码率

365
00:15:41,770 --> 00:15:43,630
第二遍再编码视频

366
00:15:43,630 --> 00:15:46,350
这样就能精准地控制码率了

367
00:15:46,350 --> 00:15:51,520
在Adobe Premiere里我们就可以选择VBR模式进行两遍编码

368
00:15:51,520 --> 00:15:55,150
选择一个目标码率 再选择一个最高码率

369
00:15:55,150 --> 00:15:59,420
这同时也是我比较推荐B站UP主使用的一种码率控制方法

370
00:15:59,420 --> 00:16:00,710
而CRF

371
00:16:00,710 --> 00:16:03,980
和上面两种以码率为目标的模式又不太一样

372
00:16:03,980 --> 00:16:06,250
CRF是固定质量模式

373
00:16:06,250 --> 00:16:09,200
顾名思义 你得先给定一个CRF质量值

374
00:16:09,200 --> 00:16:12,180
CRF越低 视频看起来的质量越高

375
00:16:12,180 --> 00:16:13,150
反之亦然

376
00:16:13,150 --> 00:16:14,060
和VBR一样

377
00:16:14,060 --> 00:16:19,280
CRF也是通过给不同场景分配不同的码率来做到最大化的资源利用

378
00:16:19,280 --> 00:16:22,320
只不过CRF以视频画质为目标

379
00:16:22,320 --> 00:16:25,730
因此最终的码率、视频大小都是不可控的

380
00:16:25,730 --> 00:16:27,680
对于没有码率限制的情况

381
00:16:27,680 --> 00:16:29,960
我们都首选CRF模式

382
00:16:29,960 --> 00:16:31,290
除了这三种模式外

383
00:16:31,290 --> 00:16:34,780
你可能还会见到ABR、CQP等模式

384
00:16:34,780 --> 00:16:38,480
其中ABR相当于码率波动更小的VBR

385
00:16:38,480 --> 00:16:41,200
而CQP则是固定量化模式

386
00:16:41,200 --> 00:16:43,400
相当于低级的CRF

387
00:16:43,400 --> 00:16:45,310
这两种模式我们不怎么用到

388
00:16:45,310 --> 00:16:46,580
这里就不多说了

389
00:16:46,580 --> 00:16:51,110
其实H.264还有很多很多非常复杂的参数

390
00:16:51,110 --> 00:16:52,340
但是不用担心

391
00:16:52,340 --> 00:16:58,150
像X264、NVENC这样的编码器都已经帮你归纳好了许多预设

392
00:16:58,150 --> 00:17:00,110
直接调用这些设置就可以了

393
00:17:00,110 --> 00:17:03,660
我们还是拿MediaCoder和OBS来举例子

394
00:17:03,660 --> 00:17:05,760
如果你选择CPU编码的话

395
00:17:05,760 --> 00:17:08,490
最最重要的就是Preset预设

396
00:17:08,490 --> 00:17:12,570
这是X264帮我们归纳好的“画质选项”

397
00:17:12,570 --> 00:17:13,800
Preset选的越慢

398
00:17:13,800 --> 00:17:15,860
同码率下的画质就越好

399
00:17:15,860 --> 00:17:17,980
当然 也就越吃CPU

400
00:17:17,980 --> 00:17:21,370
所以Preset怎么选取决于你的CPU

401
00:17:21,370 --> 00:17:24,540
以及你愿意花多少时间等你的电脑

402
00:17:24,540 --> 00:17:26,250
那么问题来了

403
00:17:26,250 --> 00:17:29,650
5Mbps码率的直播和5Mbps码率的视频

404
00:17:29,650 --> 00:17:31,000
质量一样吗？

405
00:17:31,000 --> 00:17:33,760
其实这个答案是：不一定

406
00:17:34,240 --> 00:17:37,570
直播确实就相当于实时串流的视频

407
00:17:37,570 --> 00:17:38,600
只要预设一样

408
00:17:38,600 --> 00:17:41,280
编码的过程是完全一样的

409
00:17:41,280 --> 00:17:44,710
但直播和你在B站上看到的视频又有一个区别

410
00:17:44,710 --> 00:17:47,490
UP主为了在更小的码率内达到更好的画质

411
00:17:47,490 --> 00:17:51,520
可能会使用一些非常暴力、非常吃CPU的预设

412
00:17:51,520 --> 00:17:53,280
以至于一段10分钟的视频

413
00:17:53,280 --> 00:17:54,560
为了追求画质

414
00:17:54,560 --> 00:17:57,170
甚至会压制1个小时以上

415
00:17:57,170 --> 00:17:57,880
这样一来

416
00:17:57,880 --> 00:18:01,420
60fps的视频就只能以10fps 的速度编码了

417
00:18:01,420 --> 00:18:02,700
但是反正UP主又不着急

418
00:18:02,700 --> 00:18:04,300
我就扔在那里让它压制呗

419
00:18:04,300 --> 00:18:05,860
按照10fps的速度

420
00:18:05,860 --> 00:18:08,390
我总归有一天能压完这个视频的嘛

421
00:18:08,390 --> 00:18:10,420
就算我电脑差一点 速度慢一点

422
00:18:10,420 --> 00:18:12,400
至少不会影响视频的质量

423
00:18:12,400 --> 00:18:14,510
但是直播就不一样了

424
00:18:14,510 --> 00:18:17,910
你能想象看10fps的直播是什么感觉吗？

425
00:18:17,910 --> 00:18:20,220
直播可是实时上传的视频影像

426
00:18:20,220 --> 00:18:23,200
编码速度至少得快于视频的帧率

427
00:18:23,200 --> 00:18:25,960
在这里就是每秒至少要编码60fps

428
00:18:25,960 --> 00:18:27,780
才不会出现掉帧

429
00:18:27,780 --> 00:18:28,620
为了提高速度

430
00:18:28,620 --> 00:18:30,210
就需要使用更快的预设

431
00:18:30,210 --> 00:18:31,690
牺牲编码质量

432
00:18:31,690 --> 00:18:33,770
这就意味着在码率相同的情况下

433
00:18:33,770 --> 00:18:37,570
直播的画质往往比精心制作的视频更差一些

434
00:18:37,570 --> 00:18:40,310
因为没有充足的时间来进行编码

435
00:18:40,310 --> 00:18:41,400
基于这个道理

436
00:18:41,400 --> 00:18:44,870
我们直播和视频所使用的预设也就不一样了

437
00:18:44,870 --> 00:18:45,860
直播玩游戏的话

438
00:18:45,860 --> 00:18:49,030
比如用9900K我往往会选择fast预设

439
00:18:49,030 --> 00:18:52,240
8700K我一般会选faster

440
00:18:52,240 --> 00:18:53,460
腾出一些余力

441
00:18:53,460 --> 00:18:56,260
毕竟游戏本身也会占用CPU资源

442
00:18:56,260 --> 00:18:57,380
一旦CPU占满

443
00:18:57,380 --> 00:19:00,480
你的直播流就会出现非常严重的卡顿

444
00:19:00,480 --> 00:19:02,300
但如果是转码做视频的话

445
00:19:02,300 --> 00:19:03,400
那就好办多了

446
00:19:03,400 --> 00:19:05,130
你喜欢哪个你就选哪个

447
00:19:05,130 --> 00:19:07,490
比如我们想尽可能带来最好的画质

448
00:19:07,490 --> 00:19:08,450
不太在乎速度

449
00:19:08,450 --> 00:19:11,660
所以我们自己压制视频会选择Very Slow预设

450
00:19:11,660 --> 00:19:13,180
你当然也可以选这个

451
00:19:13,180 --> 00:19:15,800
但如果你嫌编码速度太慢的话

452
00:19:15,800 --> 00:19:18,960
你也可以降级到Slow或者Medium

453
00:19:18,960 --> 00:19:20,580
你看 不管怎么说 我们转码

454
00:19:20,580 --> 00:19:23,760
选择的画质总是比直播要更好的

455
00:19:23,760 --> 00:19:25,380
讲完Profile这一条

456
00:19:25,380 --> 00:19:28,040
就已经决定了80%的画质了

457
00:19:28,040 --> 00:19:28,650
没错

458
00:19:28,650 --> 00:19:33,900
整个X264绝大多数关键选项都已经包含在Profile里面了

459
00:19:33,900 --> 00:19:35,210
非常傻瓜

460
00:19:35,210 --> 00:19:36,340
这就跟玩游戏一样

461
00:19:36,340 --> 00:19:38,330
想要画质好就开全特效

462
00:19:38,330 --> 00:19:40,020
觉得卡就降低一档预设

463
00:19:40,020 --> 00:19:40,990
多简单啊

464
00:19:40,990 --> 00:19:43,730
咱们再来聊聊剩下这20%

465
00:19:43,730 --> 00:19:45,040
除了Profile之外

466
00:19:45,040 --> 00:19:48,160
Tune（协调）也是压制视频的时候可选的一个选项

467
00:19:48,160 --> 00:19:52,160
借助Tune你可以对不同风格的视频做出参数上的优化

468
00:19:52,160 --> 00:19:55,920
比如动画我们可以选择Animation

469
00:19:55,920 --> 00:19:58,940
而噪点很多的视频我们可以选择Grain

470
00:19:58,940 --> 00:20:01,820
一图流就选Still Image

471
00:20:01,820 --> 00:20:04,940
根据不同的视频类型选择不同的Tune

472
00:20:04,940 --> 00:20:06,810
当然你也可以跟我们一样 不选

473
00:20:06,810 --> 00:20:08,640
这个并不是强制要求的

474
00:20:08,640 --> 00:20:10,820
接下来两个 就是人们很容易忽略

475
00:20:10,820 --> 00:20:12,950
但又非常重要的选项了

476
00:20:12,950 --> 00:20:15,680
Profile配置文件和Level（级别）

477
00:20:15,680 --> 00:20:19,280
Profile(配置文件)是对视频压缩特性的描述

478
00:20:19,280 --> 00:20:20,140
Profile(配置文件)越高

479
00:20:20,140 --> 00:20:22,760
就说明采用了越高级的压缩特性

480
00:20:22,760 --> 00:20:26,750
如果你把之前的Preset看成游戏的画质设定的话

481
00:20:26,750 --> 00:20:31,130
那么Profile就有点像DX10和DX11的区别了

482
00:20:31,130 --> 00:20:33,940
有的老电脑玩不了DX11的新游戏

483
00:20:33,940 --> 00:20:39,160
同样也有老设备比如PSP就只能支持Main Profile的视频

484
00:20:39,160 --> 00:20:43,720
大多数视频或直播软件默认会选择Main Profile

485
00:20:43,720 --> 00:20:46,410
但我非常建议你选择High

486
00:20:46,410 --> 00:20:49,250
因为我们不管是直播还是上传B站

487
00:20:49,250 --> 00:20:51,220
都不用照顾那些老设备的

488
00:20:51,220 --> 00:20:56,330
而High相比Main同画质下可以节约10%左右的码率

489
00:20:56,330 --> 00:20:57,310
稳赚不赔

490
00:20:57,310 --> 00:21:00,000
至于High10和更高级的配置文件

491
00:21:00,000 --> 00:21:00,860
自己玩玩可以

492
00:21:00,860 --> 00:21:02,230
上传B站就免了吧

493
00:21:02,230 --> 00:21:05,380
B站现在还不支持10bit HDR的视频投稿

494
00:21:05,380 --> 00:21:09,500
而Level是对视频参数取值作出的限定

495
00:21:09,500 --> 00:21:13,460
比如Level 4.0就规定Main Profile下的码率不能超过20Mbps

496
00:21:13,460 --> 00:21:16,400
每秒的宏块数量不能超过24万个

497
00:21:16,400 --> 00:21:19,610
说得通俗一点就是视频的天花板

498
00:21:19,610 --> 00:21:21,390
对于1080P 60fps的视频

499
00:21:21,390 --> 00:21:23,540
建议设置在Level 4.2以上

500
00:21:23,540 --> 00:21:27,830
比如我们的视频和直播都会设置在Level 5.1

501
00:21:27,830 --> 00:21:29,200
对于4K 60fps的视频

502
00:21:29,200 --> 00:21:30,660
推荐用Level 5.2

503
00:21:30,660 --> 00:21:31,220
据我所知

504
00:21:31,220 --> 00:21:36,870
现在主流的直播和视频网站对于Profile和Level的支持都挺好的

505
00:21:36,870 --> 00:21:41,620
我们全程使用High Profile和Level 5.1就可以了

506
00:21:41,620 --> 00:21:44,170
但是 还没完

507
00:21:44,170 --> 00:21:46,130
这个只是压制软件的设置

508
00:21:46,130 --> 00:21:47,990
实际上 我们剪辑的时候

509
00:21:47,990 --> 00:21:51,100
Pr默认的设置并不是High 5.1

510
00:21:51,100 --> 00:21:52,820
而是Main 4.2

511
00:21:52,820 --> 00:21:54,570
所以我们在Pr导出视频的时候

512
00:21:54,570 --> 00:21:56,110
要注意一下这个地方

513
00:21:56,110 --> 00:21:57,980
配置文件和级别这里

514
00:21:57,980 --> 00:21:59,470
我们把这两个勾去掉

515
00:21:59,470 --> 00:22:01,890
然后配置文件就可以选择“高”了

516
00:22:01,890 --> 00:22:04,580
级别其实4.2不改也没关系

517
00:22:04,580 --> 00:22:06,590
也可以选择5.1或5.2

518
00:22:06,590 --> 00:22:09,920
这个根据你的分辨率和帧率来就可以了

519
00:22:09,920 --> 00:22:11,400
那么问题来了

520
00:22:11,400 --> 00:22:14,760
如果你的CPU太烂怎么办

521
00:22:14,760 --> 00:22:17,300
这就轮到显卡编码了

522
00:22:17,300 --> 00:22:19,950
那么显卡编码是怎么一个玩法呢？

523
00:22:19,950 --> 00:22:22,240
蓝绿红三大显卡厂商

524
00:22:22,240 --> 00:22:24,500
都有自己的GPU编码器

525
00:22:24,500 --> 00:22:27,700
英特尔在第二代核显里就引入了Quick Sync Video

526
00:22:27,700 --> 00:22:32,500
英伟达也在GTX600系列上推出了NVENC编码器

527
00:22:32,500 --> 00:22:36,020
我们熟悉的Shadow Play录屏就是基于NVENC的

528
00:22:36,020 --> 00:22:39,940
至于AMD也在GCN架构上引入了VCE（AMF）编码器

529
00:22:39,940 --> 00:22:41,840
VCE易用性不如另外两家

530
00:22:41,840 --> 00:22:43,990
但可以实现一些骚功能

531
00:22:43,990 --> 00:22:46,050
比如动画补帧

532
00:22:46,050 --> 00:22:50,230
那么 这三种编码器在画质方面相比CPU的X264编码

533
00:22:50,230 --> 00:22:51,320
有没有差别呢？

534
00:22:51,320 --> 00:22:53,710
我们不妨来亲身体验一下

535
00:22:53,710 --> 00:22:57,010
有请我们的光头吴克先生

536
00:22:57,010 --> 00:22:58,720
吴克今天好像很高兴啊

537
00:22:58,720 --> 00:23:02,090
他特意在自己的大光头上印了个二维码

538
00:23:02,090 --> 00:23:05,240
我们放大看一下到底是什么呢？哦

539
00:23:05,240 --> 00:23:08,200
原来是淘宝店极客湾数码港

540
00:23:08,200 --> 00:23:13,360
看来吴克也知道在极客湾数码港能买到便宜实惠的好电脑呢

541
00:23:13,360 --> 00:23:16,340
我们的吴克测试统一通过OBS来录制

542
00:23:16,340 --> 00:23:18,300
统一采用5000kbps码率

543
00:23:18,300 --> 00:23:20,750
CPU编码选用fast预设

544
00:23:20,750 --> 00:23:23,990
而所有的显卡编码全部采用质量优先的设置

545
00:23:23,990 --> 00:23:25,580
在静止状态下

546
00:23:25,580 --> 00:23:27,780
四种编码器都很清晰

547
00:23:27,780 --> 00:23:31,950
CPU编码似乎略微更清楚一点

548
00:23:31,950 --> 00:23:36,190
但是当我们围绕光头开始圆周运动的时候

549
00:23:36,190 --> 00:23:38,110
差距就体现出来了

550
00:23:38,110 --> 00:23:42,290
CPU编码的质量要远远高于三种显卡编码器

551
00:23:42,290 --> 00:23:43,860
而在显卡编码器中

552
00:23:43,860 --> 00:23:47,880
英特尔核显的质量又要略微好于两款独显

553
00:23:47,880 --> 00:23:52,010
总的来说三款显卡编码算是半斤八两

554
00:23:52,010 --> 00:23:53,290
菜鸡互啄了

555
00:23:53,440 --> 00:23:55,210
照这么说的话

556
00:23:55,210 --> 00:23:57,870
岂不是显卡编码就没什么卵用了吗？

557
00:23:57,870 --> 00:23:59,650
哎 怎么能这么说呢？

558
00:23:59,650 --> 00:24:03,060
你也不看看x264下cpu的占用率

559
00:24:03,060 --> 00:24:04,620
我们只是用了fast预设

560
00:24:04,620 --> 00:24:07,830
9900K的占用率就达到了30-40%

561
00:24:07,830 --> 00:24:10,570
如果再加上游戏本身占用的40%

562
00:24:10,570 --> 00:24:13,610
那CPU几乎是接近满载的状态了

563
00:24:13,610 --> 00:24:15,180
这用的还是9900K呢！

564
00:24:15,180 --> 00:24:17,050
万一你用的是i5 8400呢？

565
00:24:17,050 --> 00:24:19,120
你还敢用CPU编码么？

566
00:24:19,120 --> 00:24:22,600
这就是为什么即便CPU编码的质量更好

567
00:24:22,600 --> 00:24:25,150
我们还是需要显卡编码

568
00:24:25,150 --> 00:24:27,500
尤其是对于那些CPU比较差

569
00:24:27,500 --> 00:24:29,560
但又打算直播的朋友

570
00:24:29,560 --> 00:24:31,190
但如果只是做视频

571
00:24:31,190 --> 00:24:32,070
不直播的话

572
00:24:32,070 --> 00:24:36,480
我无论如何都建议你使用X264 CPU编码器

573
00:24:36,480 --> 00:24:38,480
那么这一期序章的最后

574
00:24:38,480 --> 00:24:41,230
我就结合咱们今天学到的这些

575
00:24:41,230 --> 00:24:44,810
来演示一下传B站的视频怎么压比较好

576
00:24:44,810 --> 00:24:49,440
压制软件我们比较喜欢的是MeGUI和MediaCoder这两个

577
00:24:49,440 --> 00:24:51,040
MeGUI比较专业

578
00:24:51,040 --> 00:24:51,700
比较正规

579
00:24:51,700 --> 00:24:54,630
需要你学会AVISynth脚本

580
00:24:54,630 --> 00:24:57,800
但MediaCoder的UI更加直观

581
00:24:57,800 --> 00:24:59,190
比较适合小白

582
00:24:59,190 --> 00:25:02,800
首先看看B站的视频上传规范

583
00:25:02,800 --> 00:25:05,280
目标码率最高6Mbps

584
00:25:05,280 --> 00:25:07,830
峰值码率最高24Mbps

585
00:25:07,830 --> 00:25:10,440
这个码率限制给得还是比较充裕的

586
00:25:10,440 --> 00:25:12,670
关键帧平均至少10秒一个

587
00:25:12,670 --> 00:25:16,420
也就是60帧的视频GOP最好控制在600以下

588
00:25:16,420 --> 00:25:17,530
这就很清楚了

589
00:25:17,530 --> 00:25:19,750
我们选择2次编码模式

590
00:25:19,750 --> 00:25:21,000
也就是VBR

591
00:25:21,000 --> 00:25:23,300
视频码率给到5900

592
00:25:23,300 --> 00:25:25,250
最高码率给到23000

593
00:25:25,250 --> 00:25:27,730
严格控制在二压线以内

594
00:25:27,730 --> 00:25:30,280
然后规格Profile选择High

595
00:25:30,280 --> 00:25:31,600
Level选择5.1

596
00:25:31,600 --> 00:25:33,780
Preset预设给到Very Slow

597
00:25:33,780 --> 00:25:35,730
如果你不介意多等一个小时的话

598
00:25:35,730 --> 00:25:37,650
也可以用Placebo

599
00:25:37,650 --> 00:25:39,150
Tune看你的视频内容

600
00:25:39,150 --> 00:25:41,760
比如动画就选Animation

601
00:25:41,760 --> 00:25:43,570
不选也没问题

602
00:25:43,570 --> 00:25:46,200
GOP我们给1-600

603
00:25:46,200 --> 00:25:47,210
范围宽泛一点

604
00:25:47,210 --> 00:25:48,560
这样其实已经足够了

605
00:25:48,560 --> 00:25:51,860
剩下的小参基本上已经涵盖在Profile里了

606
00:25:51,860 --> 00:25:53,210
不需要你自己操心

607
00:25:53,210 --> 00:25:56,050
这样的设定 相当于把压力全扔给了CPU

608
00:25:56,050 --> 00:25:57,750
来换取高压缩率

609
00:25:57,750 --> 00:25:58,980
应该说是非常暴力的了

610
00:25:58,980 --> 00:26:02,050
可以最大限度地提高上传B站的视频质量

611
00:26:02,050 --> 00:26:05,640
如果你使用的不是MediaCoder或者MeGUI

612
00:26:05,640 --> 00:26:07,300
而是是UI比较简单

613
00:26:07,300 --> 00:26:09,870
没有参数设置的一些转码工具

614
00:26:09,870 --> 00:26:11,690
比如小丸工具箱的话

615
00:26:11,690 --> 00:26:16,160
你也可以通过X264命令行来自定义参数

616
00:26:16,160 --> 00:26:19,840
比如我们刚才在MediaCoder主界面上看到的那几个参数

617
00:26:19,840 --> 00:26:24,420
就可以通过输入这几个命令来实现修改

618
00:26:28,480 --> 00:26:29,400
当然

619
00:26:29,400 --> 00:26:31,540
套预设如果是万能的话

620
00:26:31,540 --> 00:26:34,180
就不会有那么多人研究压制了

621
00:26:34,180 --> 00:26:36,740
如果你要深入接触X264

622
00:26:36,740 --> 00:26:38,630
进一步优化你的视频质量

623
00:26:38,630 --> 00:26:43,250
那么光靠这些小打小闹的预设是远远不够的

624
00:26:43,250 --> 00:26:47,170
你一定逃不过AVS脚本这个东西

625
00:26:47,170 --> 00:26:48,520
在MeGUI中

626
00:26:48,520 --> 00:26:51,750
我们每次压制都需要使用一个AVS脚本

627
00:26:51,750 --> 00:26:55,330
那么你可以直接在这里编写脚本

628
00:26:55,330 --> 00:26:56,970
来个性化你的压制

629
00:26:56,970 --> 00:26:58,070
举个最简单的例子

630
00:26:58,070 --> 00:27:01,330
我想把一部4K的电影压制到1080p

631
00:27:01,330 --> 00:27:04,250
那么我就要考虑用什么样的缩放算法

632
00:27:04,250 --> 00:27:06,860
比如我这里用Spline36

633
00:27:06,860 --> 00:27:10,650
那4K变到1080会不会很不清晰呢？

634
00:27:10,650 --> 00:27:15,840
我们可以把锐度往上提0.3

635
00:27:15,840 --> 00:27:17,560
这样看起来就感觉

636
00:27:17,560 --> 00:27:19,090
「哇 简直跟4K一样」

637
00:27:19,090 --> 00:27:21,900
然后我想降到30帧

638
00:27:21,900 --> 00:27:24,140
可以改上面的AssumeFPS

639
00:27:24,140 --> 00:27:26,260
以及DSS里这个FPS

640
00:27:26,790 --> 00:27:30,340
最后我想要在视频结尾加个淡出效果

641
00:27:30,340 --> 00:27:32,600
我可以写FadeOut(30)

642
00:27:32,600 --> 00:27:34,670
那么最后30帧就是淡出的

643
00:27:34,670 --> 00:27:40,110
我这里就是举些简单的例子告诉你们AVS是干嘛用的

644
00:27:40,110 --> 00:27:44,090
比如电影和游戏它们都会有不同的关注点

645
00:27:44,090 --> 00:27:46,150
不同的压制技巧

646
00:27:46,150 --> 00:27:48,250
自然就有不同的脚本写法

647
00:27:48,250 --> 00:27:53,060
如果要压出最高质量的 最适合你的视频

648
00:27:53,060 --> 00:27:55,900
那就必须要好好学习一下AVS脚本

649
00:27:55,900 --> 00:28:01,780
感兴趣的同学可以通过avisynth.nl这个网站来了解AVS的各种用法

650
00:28:01,780 --> 00:28:03,960
这是个AVS的百科全书

651
00:28:03,960 --> 00:28:06,080
包括在doom9论坛（forum.doom9.org）

652
00:28:06,080 --> 00:28:09,780
你可以从一些大神那里学到很多有用的压制技巧

653
00:28:09,780 --> 00:28:12,000
建议你活用一下谷歌翻译

654
00:28:12,000 --> 00:28:13,500
边看边实践

655
00:28:13,500 --> 00:28:14,640
这里我就指个路

656
00:28:14,640 --> 00:28:16,240
多的就不展开了

657
00:28:16,240 --> 00:28:19,240
OK 我们总算讲完了

658
00:28:19,240 --> 00:28:22,140
视频编码这个东西真的是个无底洞

659
00:28:22,140 --> 00:28:23,100
你只要想学

660
00:28:23,100 --> 00:28:24,880
你可以学一整年

661
00:28:24,880 --> 00:28:27,010
我们刚刚讲的那么一大串

662
00:28:27,010 --> 00:28:29,470
也只是些用的最多的东西

663
00:28:29,470 --> 00:28:33,630
跟编码的学问比起来真的是冰山一角

664
00:28:33,630 --> 00:28:34,830
如果以后有机会

665
00:28:34,830 --> 00:28:36,910
我们可能还会再聊聊H.265

666
00:28:36,910 --> 00:28:38,190
HEVC

667
00:28:38,190 --> 00:28:40,370
但是今天就不展开了

668
00:28:40,370 --> 00:28:41,610
做这一期节目

669
00:28:41,610 --> 00:28:43,810
主要是为了下一期节目做铺垫

670
00:28:43,810 --> 00:28:44,840
在下一期节目里

671
00:28:44,840 --> 00:28:48,850
我们会手把手教大家如何进行高质量的直播

672
00:28:48,850 --> 00:28:52,400
从任何一台电脑的业余直播

673
00:28:52,400 --> 00:28:55,740
到使用采集卡的专业主播

674
00:28:55,740 --> 00:28:57,060
从硬件到软件

675
00:28:57,060 --> 00:28:58,620
我们一个个分析

676
00:28:58,620 --> 00:29:00,880
包括我们也会来一次极限挑战

677
00:29:00,880 --> 00:29:03,410
试试看能不能4K直播

678
00:29:03,410 --> 00:29:05,900
喜欢我们的视频别忘了点关注

679
00:29:05,900 --> 00:29:08,610
还有长按点赞一键三连

680
00:29:08,610 --> 00:29:11,640
也别忘了关注淘宝店“极客湾数码港”

681
00:29:11,640 --> 00:29:14,020
各种价位的游戏本商务本

682
00:29:14,020 --> 00:29:16,500
让你尝到真正的实惠

683
00:29:16,500 --> 00:29:18,690
还要记得关注微信公众号“极客湾”哦

684
00:29:18,690 --> 00:29:20,690
我们下期节目再见吧！


